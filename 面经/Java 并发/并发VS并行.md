并发（concurrency）和并行（parallelism）两个术语经常被使用在多线程程序中。首先并发和并行看起来是相似的概念，然而并发和并行实际有不同的含义，在这个并发 VS 并行的教程中我将解释他们各自的概念。

澄清一下，在这个文章中看到的 并发和并行是在单个应用单个进程中，没有多个应用、进程或者计算机。

## 并发（concurrency）

并发的定义是一个应用执行超过一个任务在同一时间或者看似同一时间（并发的）。

如果计算机只有一个 CPU，程序确切地说不能同时执行多个任务在同一时间，但是程序中同时有超过一个任务在执行。并发的执行超过一个任务实际上是 CPU 通过时间片轮转的方式切换不同任务，下面是设计图：
img

## 并行执行（parallel）

并行执行是当计算机有超过一个 CPU 或者 核心 是，同时执行超过一个任务。然而并行执行不是指类似并行的执行。后续会继续说明并行，并行执行示意图如下：

## 并行并发执行（Parallel Concurrent Execution）

并行并发执行也是有可能的，线程分布在多个 CPU 上，因此在同一 CPU 线程并发执行，在不同 CPU 上并行执行，并行并发执行的示意图如下：

## 并行（Parallelism）

并行的意思是 一个应用程序分割成相似的可以平行执行的子任务，例如同一时间点在多 CPU 上执行。因此，并行与并行并发执行不是类似的执行模型，即使他们表面上看起来很像。

在程序中真正实现并行，必须有超过一个线程运行，每个线程必须运行在独立的 CPU、CPU内核或者类似显卡GPU 核心上.

设计参考图，一个大的任务，分成 4 个子任务，有 4 个子任务被执行通过 4 不同的线程，运行在两个不同的 CPU 上。这个意思就是，相同 CPU 上的这部分子任务并发执行，不同 CPU 这部分并行执行。

如果代替 4 个子任务执行，通过 4个线程运行在自己的 CPU 上（4个CPU），此时所有的任务执行都是并行的。然而，将任务分解成与可用CPU数量一样多的子任务并不总是那么容易。通常，可以将任务分解与自然任务匹配的多个子任务，然后让线程调度程序负责在 CPU 之间分配线程。

## 并发和并行组合

简单回顾，并发指的 一个 CPU 看起来可以同时运行多个任务（AKA 并发）。另一方面，并行更关心程序是如何并行执行一个任务，典型的通过任务切分成多个子任务，子任务可以并行完成。

这里有两个执行风格，可以在同一个程序中合并，下面将逐一介绍这两种合并：

### 并发，无并行（Concurrent, Not Parallel）

程序有并发但是没有并行，这个意思是看似同时执行多个任务（并发），实际上通过切换执行每个任务，知道任务执行完成，这里没有真正的并行执行任务在并行多线程/多CPU中。

### 并行，无并发（Parallel, Not Concurrent）

应用也可以只有并行没有并发，这个意思是应用程序同时仅仅处理一个线程，并且这个任务被拆分成可以同时执行的子任务。然而，每个任务（子任务）被完成在其他任务拆分并行之前。

### 即无并行也无并发（Neither Concurrent Nor Parallel）
此外，应用程序可以既没有并发也没有并行，这个意思是同时只有一个工作，并且工作不被拆分成子任务并行执行。小型命令行工具可能存在这种情况，仅仅只有一个 job 太小，无法并行化处理，

### 并发和并行（Concurrent and Parallel）

最后程序可以既有并行也有并发两种方式：

首先简单的并行并发执行，如果程序开启多线程并且线程执行在多CPU上时会发生。其次，程序都工作在并发多任务中，并且每个任务拆分成子任务并行执行。在这种情况下，并发性和并行性的某些好处可能会丢失，因为计算机中的CPU已经足够合理地仅使用并发性或并行性了。结合使用它可能只会导致很小的性能提升，甚至会导致性能下降。在盲目采用并发并行模型之前，请确保进行分析和衡量。